---
import TOC from "./TOC.astro";
import type { MarkdownHeading } from "astro";

interface Props {
  headings: MarkdownHeading[];
}

const { headings } = Astro.props;
---

<div class="mobile-toc-container">
  <button id="mobile-toc-toggle" aria-label="Toggle Table of Contents">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="icon"
    >
      <path d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
  </button>

  <div class="mobile-toc-dropdown">
    <TOC headings={headings} />
  </div>
</div>

<script is:inline>
  const mobileTocToggle = document.getElementById("mobile-toc-toggle");
  const mobileTocDropdown = document.querySelector(".mobile-toc-dropdown");

  if (mobileTocToggle && mobileTocDropdown) {
    mobileTocToggle.addEventListener("click", () => {
      mobileTocDropdown.classList.toggle("active");
    });

    document.addEventListener("click", (event) => {
      if (
        !mobileTocDropdown.contains(event.target) &&
        !mobileTocToggle.contains(event.target) &&
        mobileTocDropdown.classList.contains("active")
      ) {
        mobileTocDropdown.classList.remove("active");
      }
    });
  }
</script>

<style>
  .mobile-toc-container {
    display: none; /* Hidden by default, shown on mobile */
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999; /* Increased z-index to ensure it's on top */
  }

  .mobile-toc-container button {
    background-color: var(--mode-button-bg);
    color: var(--background-color);
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: var(--box-shadow);
  }

  .mobile-toc-container button .icon {
    width: 24px;
    height: 24px;
  }

  .mobile-toc-dropdown {
    position: absolute;
    bottom: 60px; /* Above the button */
    right: 0;
    background-color: var(--tocy);
    width: 250px; /* Adjust as needed */
    max-width: calc(100vw - 40px); /* Ensure it doesn't overflow viewport */
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition:
      opacity 0.3s ease,
      transform 0.3s ease,
      visibility 0.3s ease,
      max-height 0.3s ease;
    flex-direction: column;
    /* Removed padding from here */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    max-height: 0; /* Start collapsed */
    overflow: hidden;
    border: 1px solid var(--hamburger-border);
  }

  .mobile-toc-dropdown.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    max-height: 70vh; /* Expand to max height */
    display: flex; /* Keep display flex for layout */
  }

  /* Adjust TOC styling within the mobile dropdown */
  .mobile-toc-dropdown .toc {
    padding: 0; /* Remove padding from TOC component */
    border: none; /* Remove border from TOC component */
    background-color: var(--tocy); /* Make TOC background match dropdown */
    box-shadow: none; /* Remove shadow from TOC component */
    max-height: none; /* Allow TOC to take full height of dropdown */
    overflow-y: visible; /* Allow dropdown to handle scrolling */
    border-radius: 8px; /* Match dropdown's border-radius */
  }

  .mobile-toc-dropdown .toc ul {
    list-style: none;
    padding: 0.5rem 0; /* Added padding here */
    margin: 0;
  }

  .mobile-toc-dropdown .toc li {
    list-style: none;
    padding: 0.5rem 1rem;
    margin-bottom: 0; /* Remove margin from TOC li */
  }

  .mobile-toc-dropdown .toc a {
    text-decoration: none;
    color: var(--text-color);
    display: block;
    padding: 0.5rem; /* Match nav link padding */
    transition: none; /* Remove TOC's hover transition */
  }

  .mobile-toc-dropdown .toc a:hover {
    background: var(--drop-menu-highlight);
    border-radius: 4px;
    color: var(--text-color); /* Ensure text color doesn't change on hover */
  }

  /* Show on screens smaller than 900px (matching MarkdownPostLayout's media query) */
  @media (max-width: 1400px) {
    .mobile-toc-container {
      display: block;
    }
  }
</style>
